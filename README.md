# monitoring
Мониторинг основы

**Мониторинг** — процесс наблюдения и регистрации данных о каком-либо объекте на неразрывно примыкающих друг к другу интервалах времени, в течение которых значения данных существенно не изменяются

**Источники данных**
- Нагрузка на HDD, CPU, RAM у серверов и рабочих станций
- Очереди на запись / обработку данных
- Статус выполнения ПО
- Скорости обмена на портах коммутаторов
- Контрольные суммы на различные файлы
- Файлы логов, параметры в конфигурациях
- Статусы цифровых и аналоговых датчиков
- Состояния баз данных и целостность файлов
- Доступность сервисов

**Типы мониторинга**

Агентно-ориентированный - Agent-based -  Получение данных от специального программного обеспечения (агента), установленного на наблюдаемом объекте (операционной системе)
- Возможности - Более глубокое видение ситуации относительно состояния наблюдаемого объекта / Способность влиять на ситуацию
- Ограничения - Зависимость от типа агента: открытый код или закрытое решение

Безагентный - Agentless - Считывание данных с интерфейсов, предоставляющих данные через выполнение каких-либо команд на наблюдаемом хосте, без необходимости установки туда отдельного программногообеспечения (агента)
- Возможности - Использование агента (интерфейса обмена данными), который встроен в наблюдаемую систему / Встроенные агенты не требуют дополнительной установки, настройки и лицензирования
- Ограничения -  Нужно делиться учётными данными / Когда мониторинг не работает, данные не собираются

**Выбор типа мониторинга**
- Агентно-ориентированный - Поставить специальное ПО, затратив силы и ресурсы, и получить любую интересующую информацию
- Безагентный - Не ставить ничего, но ограничиться лишь данными, предусмотренными разработчиком протокола

Максимальной эффективности от мониторинга можно достичь через сочетание подходов. 
- Иногда установка агентов не имеет смысла, так как невозможно получить больше информации из наблюдаемого объекта: объект выкатывает все избыточно необходимые метрики по SNMP или нельзя установить дополнительное ПО, например управляемый коммутатор или принтер
- Иногда необходимо мониторить кастомные параметры, которые не представлены ни через один протокол или интерфейс. В этом случае установка агента предоставит ультимативные возможности относительно сбора данных об объекте

**Zabbix**

Решение распределённого мониторинга корпоративного класса с открытыми исходными кодами. Программное обеспечение для мониторинга многочисленных параметров сети, жизнеспособности и целостности серверов, виртуальных машин, приложений, сервисов, баз данных, веб-сайтов, облачных сред и многого другого

Возможности Zabbix - Универсальный мониторинг - Мониторинг любой ИТ-инфраструктуры, облачных ресурсов, сервисов, приложений.

**Источники данных**
- Масштабы решаемых задач варьируются от установки на Raspberry Pi (с целью мониторинга какого-то локального датчика, подключённого к ней же) до десятков тысяч узлов сети, наблюдаемых одним Zabbix-сервером
- Разработка проекта не останавливалась никогда: регулярно выходят новые и LTS-версии
- Агенты доступны почти для любой ОС из коробки. Если нет готового пакета, то можно взять исходники и сделать компиляцию

**Архитектура Zabbix**
У Zabbix есть 4 основных инструмента, с помощью которых можно мониторить определённую рабочую среду и собирать о ней полный пакет данных для оптимизации работы.
- Сервер - Ядро, обрабатывающее в себе все данные системы, включая статистические, оперативные и конфигурацию
- Прокси - Сервис, позволяющий общаться с агентами в удалённой сети так, будто сервер общается с ними напрямую
- Агент - Программа, которая активно мониторит и собирает статистику работы локальных ресурсов и приложений
- Веб-сервис - Позволяет настраивать Zabbix-сервер через веб-интерфейс

**Zabbix Server** - Основная цель Zabbix Server — следить за агентами
- Сам Zabbix Server занимается только сбором и обработкой поступающей от агентов информации
- zabbix_server — демон сервера Zabbix
- zabbix_server.conf — файл конфигурации Zabbix Server
- zabbix_server.log — файл логов Zabbix Server

- Следит за каждым подключённым к нему агентом и знает о них всё
- Заносит в список все новые агенты, обратившиеся к нему впервые, и в дальнейшем следит за ними
- Ищет новые узлы сети, отбирает их по специализированным параметрам и начинает отслеживать, что с ними происходит
- Если Zabbix Server не может следить за узлами сети самостоятельно, он может использовать Zabbix Proxy

**Zabbix Agent** - Основная цель Zabbix Agent — следить за всем остальным
- Сначала агент распознаёт, какие элементы можно мониторить на текущем хосте
- Далее агент передаёт эту информацию на сервер
- Сервер отправляет агенту информацию, за чем конкретно ему следить

** Требования к базам данных для Zabbix**
- Zabbix Server и Zabbix Proxy не могут работать без взаимодействия с БД. При этом только Zabbix Proxy способна работать с SQLite

- CentOS - VM - MySQL InnoDB - 20 узлов
- CentOS - 2 ядра CPU / 2 ГБ - MySQL InnoDB - 500 узлов
- Red Hat Enterprise Linux - 4 ядра CPU / 8 ГБ - RAID10 MySQL InnoDBили PostgreSQL - >1 000 узлов
- Red Hat Enterprise Linux - 8 ядер CPU / 16 ГБ - Быстрый RAID10 MySQL InnoDB или PostgreSQL - >10 000 узлов

**Prometheus**

Это open-source-набор инструментов, предназначенный для оповещения о каких-либо событиях, происходящих на хостах, находящихся у него на мониторинге

**Возможности Prometheus**
- Обработка данных, представленных во временных рядах
- Мониторинг аппаратных ресурсов
- Мониторинг динамичной сервис-ориентированной архитектуры

**История Prometheus**
- Впервые разработан для внутреннего использования проектом SoundCloud
- С момента своего появления в 2012 году Prometheus был взят на вооружение многими крупными компаниями: DigitalOcean, Ericsson, CoreOS, Weaveworks, Red Hat и Google
- Имеет активную команду разработчиков и комьюнити
- Сегодня проект развивается независимо от какой-либо компани

**Принцип работы Prometheus**
- Collector читает таблицу целей (targets), т. е. список объектов, которые надо мониторить, и периодичность их опроса
- После этого collector отправляет HTTP-запрос на каждый эндпоинт и получает ответ с набором из метрик. У каждой метрики есть название, значение и лейблы
- Полученный ответ складывается в базу данных TSDB, где к полученным данным о метрике добавляются отметка времени её получения и лейблы объекта, с которого она была взята
- Service Discovery — встроенный в Prometheus механизм обнаружения сервисов, который позволяет из коробки получать данные для создания таблицы целей

**Сравнение Prometheus с Zabbix**
В отличие от Zabbix, который является законченным продуктом, имеющим из коробки весь базовый необходимый функционал, Prometheus требует доработок:
- интерфейс с графиками и дашбордами — сторонняя разработка, подключаемая к Prometheus
- ограниченная работа Prometheus с оповещениями
- недоступны авторизация и контроль пользователей для Prometheus

Изначально Prometheus рассчитан на активную доработку со стороны эксплуатирующей организации, что делает его более удобным для специфических задач.
- Программисты не ограничены уже существующими механизмами авторизации, способами извлечения данных из приложений, интерфейсом и чем-либо вообще
- Эксплуатирующие подразделения для доведения Prometheus до кондиции могут использовать уже имеющиеся, готовые и работающие решения

- Prometheus — одна из самых популярных систем мониторинга. Оптимальна для мониторинга динамичной контейнерной инфраструктуры
- Prometheus получает данные из специальных экспортеров, которые позволяют ему забирать все собираемые о наблюдаемом объекте данные за одно действие
- С помощью библиотек Prometheus можно добавить возможность мониторинга своего ПО с минимальными трудозатратами со стороны разработчиков
